(this.webpackJsonpaviasales=this.webpackJsonpaviasales||[]).push([[0],[,,,,,,,,function(t,e,n){t.exports=n.p+"static/media/logo.0c089234.svg"},,,function(t,e,n){t.exports=n(22)},,,,,function(t,e,n){},function(t,e,n){},,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var a=n(0),s=n.n(a),r=n(5),i=n.n(r),c=(n(16),n(17),n(2)),o=n.n(c),l=n(3),u=n(6),h=n(7),p=n(1),f=n(10),m=n(9),d=n(8),v=n.n(d),k=(n(19),function(t,e){return e[t%100>4&&t%100<20?2:[2,0,1,1,1,2][Math.min(t%10,5)]]}),g=(n(20),function(t){return t<10?"0".concat(t):t}),E=function(t){return"".concat(g(t.getHours()),":").concat(g(t.getMinutes()))},b=["\u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430","\u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438","\u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"],_=function(t){var e=t.ticket;return s.a.createElement("div",{className:"ticket"},s.a.createElement("div",{className:"ticket__top"},s.a.createElement("span",{className:"ticket__price"},e.price," \u0420"),s.a.createElement("img",{src:"http://pics.avs.io/99/36/".concat(e.carrier,".png"),className:"ticket__logo",alt:"logo"})),e.segments.map((function(t,e){return s.a.createElement("div",{className:"ticket__options",key:e},s.a.createElement("div",{className:"ticket__info"},s.a.createElement("span",null,t.origin," - ",t.destination),s.a.createElement("span",null,function(t,e){var n=new Date(t),a=new Date(n.getTime()+60*e*1e3);return"".concat(E(n)," - ").concat(E(a))}(t.date,t.duration))),s.a.createElement("div",{className:"ticket__info"},s.a.createElement("span",null,"\u0412 \u043f\u0443\u0442\u0438"),s.a.createElement("span",null,function(t){var e=(t/60).toFixed(2).split("."),n=+e[0],a=+e[1];return a>60&&(a-=60,n+=1),"".concat(n,"\u0447 ").concat(a,"\u043c")}(t.duration))),t.stops.length?s.a.createElement("div",{className:"ticket__info"},s.a.createElement("span",null,t.stops.length," ",(n=t.stops.length,k(n,b))),s.a.createElement("span",null,t.stops.join(", "))):"");var n})))},y=(n(21),function(t){var e=t.stops.sort(),n=["\u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430","\u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438","\u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"];return s.a.createElement("div",{className:"filter"},s.a.createElement("div",{className:"filter__title"},"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"),e.map((function(e,a){return s.a.createElement("label",{className:"filter__checkbox",key:a},s.a.createElement("input",{type:"checkbox",name:e,checked:t.filteredBy.includes(e),onChange:t.handleChange}),s.a.createElement("span",null,(r=e)>0?"".concat(r," ").concat(k(r,n)):0===r?"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a":"\u0412\u0441\u0435"));var r})))}),N=function(t){Object(f.a)(n,t);var e=Object(m.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).state={isLoading:!0,tickets:[],stops:[],filteredBy:[-1],errorText:"",activeBtn:null,cheapest:null,fastest:null},a.baseTickets=[],a.attempts=0,a.sortTickets=a.sortTickets.bind(Object(p.a)(a)),a.filterTickets=a.filterTickets.bind(Object(p.a)(a)),a.handleSortChange=a.handleSortChange.bind(Object(p.a)(a)),a.handleFilterChange=a.handleFilterChange.bind(Object(p.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var t=Object(l.a)(o.a.mark((function t(){var e;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://front-test.beta.aviasales.ru/search").then((function(t){return t.json()})).then((function(t){return t.searchId})).catch((function(t){return console.error(new Error(t))}));case 2:return e=t.sent,t.next=5,this.connectToDb(e);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"connectToDb",value:function(){var t=Object(l.a)(o.a.mark((function t(e){var n=this;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://front-test.beta.aviasales.ru/tickets?searchId=".concat(e)).then((function(t){return t.json()})).then((function(t){var e=t.tickets.map((function(t,e){return t.id=e,t})),a=[-1];e.forEach((function(t){t.segments.forEach((function(t){a.includes(t.stops.length)||a.push(t.stops.length)}))})),n.baseTickets=e,n.setState({tickets:e,stops:a},n.findOptimal)}));case 3:t.next=14;break;case 5:if(t.prev=5,t.t0=t.catch(0),console.error(t.t0),!(this.attempts++<3)){t.next=13;break}return t.next=11,this.connectToDb(e);case 11:t.next=14;break;case 13:this.setState({errorText:"\u0447\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a :(",isLoading:!1});case 14:case"end":return t.stop()}}),t,this,[[0,5]])})));return function(e){return t.apply(this,arguments)}}()},{key:"handleFilterChange",value:function(t){var e=t.target,n=+e.name,a=this.state.filteredBy;e.checked?-1===n?a=[-1]:(a=a.filter((function(t){return-1!==t}))).push(n):0===(a=a.filter((function(t){return t!==n}))).length&&a.push(-1),this.setState({filteredBy:a},this.filterTickets)}},{key:"filterTickets",value:function(){var t=JSON.parse(JSON.stringify(this.baseTickets)),e=this.state.filteredBy;-1!==e[0]&&(t=t.filter((function(t){return t.segments=t.segments.filter((function(t){return e.includes(t.stops.length)})),t.segments.length}))),this.setState({tickets:t},this.sortTickets)}},{key:"handleSortChange",value:function(t){var e=t.target,n=this.state.activeBtn;n&&n.classList.remove("active"),n===e?n=null:(e.classList.add("active"),n=e),this.setState({activeBtn:n},this.sortTickets)}},{key:"sortTickets",value:function(){var t=this.state.tickets,e=this.state.activeBtn;if(e)switch(e.dataset.sort){case"cheapest":t=t.sort((function(t,e){return t.price-e.price}));break;default:t=t.map((function(t){return t.segments=t.segments.sort((function(t,e){return t.duration-e.duration})),t})).sort((function(t,e){return t.segments[0].duration-e.segments[0].duration}))}else t=t.sort((function(t,e){return t.id-e.id}));this.setState({tickets:t},this.findOptimal)}},{key:"findOptimal",value:function(){this.findCheapest(),this.findFastest()}},{key:"findCheapest",value:function(){var t=this.state.tickets.reduce((function(t,e){return e.price<t?e.price:t}),this.state.tickets[0].price);this.setState({cheapest:t})}},{key:"findFastest",value:function(){var t={item:this.state.tickets[0],duration:this.state.tickets[0].segments[0].duration};this.state.tickets.forEach((function(e){e.segments.forEach((function(n){var a=n.duration;a<t.duration&&(t={item:e,duration:a})}))})),this.setState({fastest:t.item.price})}},{key:"render",value:function(){return s.a.createElement("div",{className:"container"},this.state.isLoading?s.a.createElement("div",{className:"app-loader"},s.a.createElement("span",null),s.a.createElement("span",null),s.a.createElement("span",null),s.a.createElement("span",null)):s.a.createElement("div",{className:"app"},s.a.createElement("img",{src:v.a,className:"app__logo",alt:"logo"}),s.a.createElement("div",{className:"app__inner"},s.a.createElement(y,{stops:this.state.stops,filteredBy:this.state.filteredBy,handleChange:this.handleFilterChange}),s.a.createElement("div",{className:"app__main"},s.a.createElement("div",{className:"app__sort"},s.a.createElement("button",{type:"button","data-sort":"cheapest",onClick:this.handleSortChange},"\u0421\u0430\u043c\u044b\u0439 \u0434\u0435\u0448\u0435\u0432\u044b\u0439 ",s.a.createElement("span",null,this.state.cheapest)),s.a.createElement("button",{type:"button","data-sort":"fastest",onClick:this.handleSortChange},"\u0421\u0430\u043c\u044b\u0439 \u0431\u044b\u0441\u0442\u0440\u044b\u0439 ",s.a.createElement("span",null,this.state.fastest))),""!==this.state.errorText?s.a.createElement("div",{className:"app__error"},this.state.errorText):this.state.tickets.map((function(t,e){return s.a.createElement(_,{ticket:t,key:e})}))))))}}]),n}(a.Component);i.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(N,null)),document.getElementById("root"))}],[[11,1,2]]]);
//# sourceMappingURL=main.0db37cad.chunk.js.map